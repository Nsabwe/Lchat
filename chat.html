<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CLChat ðŸ’«</title>
<style>
body { margin:0;font-family:'Segoe UI',sans-serif;display:flex;height:100vh;background:linear-gradient(135deg,#000,#282828);color:#fff;}
#users {width:250px;background:rgba(255,255,255,0.08);border-right:1px solid rgba(255,255,255,0.15);padding:15px;display:flex;flex-direction:column;align-items:center;overflow-y:auto;}
#users h1 {color:gold;}
#users-list {list-style:none;padding:0;width:100%;}
.user-item {display:flex;align-items:center;margin-bottom:8px;cursor:pointer;padding:5px;border-radius:6px;}
.user-item:hover {background:rgba(255,215,0,0.15);}
.user-avatar {width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#000;font-weight:bold;margin-right:10px;}
.status-dot {width:10px;height:10px;border-radius:50%;margin-left:auto;border:1px solid #000;}
.status-online {background:#90ee90;}
.status-offline {background:gray;}
.status-typing {background:#ffd700;animation:blink 1s infinite;}
@keyframes blink {0%,50%,100%{opacity:1;}25%,75%{opacity:0;}}
#chat {flex:1;display:flex;flex-direction:column;background:rgba(255,255,255,0.05);}
#chat-status {text-align:center;color:#ccc;margin:5px 0;}
#messages {flex:1;padding:20px;overflow-y:auto;font-size:15px;display:flex;flex-direction:column;}
.message {margin-bottom:10px;padding:8px 12px;border-radius:8px;max-width:80%;display:flex;align-items:center;}
.message-avatar {width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#000;font-weight:bold;margin-right:10px;}
.message-content {display:flex;flex-direction:column;}
.username {font-weight:bold;}
.timestamp {font-size:11px;color:#ccc;margin-left:5px;}
.private-label {font-size:12px;color:#ffd700;margin-left:5px;font-weight:bold;}
.message.private {background:rgba(255,215,0,0.2);border:1px solid gold;}
.message.own {background:rgba(30,144,255,0.2);border:1px solid #1E90FF;align-self:flex-end;}
#message-form {display:flex;padding:10px;border-top:1px solid rgba(255,255,255,0.2);}
#message-input {flex:1;padding:10px;border:none;border-radius:6px;background:rgba(255,255,255,0.1);color:#fff;outline:none;}
#message-submit {padding:10px 20px;margin-left:10px;border:none;border-radius:6px;background:linear-gradient(135deg,#ffd700,#ffb700);color:#000;font-weight:bold;cursor:pointer;}
.typing-indicator {font-size:13px;color:#ccc;font-style:italic;margin-bottom:5px;}
.highlight {animation: highlight 2s;}
@keyframes highlight {0%{background-color:#ffff0040;}100%{background-color:transparent;}}
</style>
</head>
<body>
<div id="users">
  <h1>CLChat ðŸ’«</h1>
  <h3>Online Users</h3>
  <input type="text" id="user-search" placeholder="Search users..." autocomplete="off">
  <ul id="users-list"></ul>
</div>
<div id="chat">
  <div id="chat-status">Public chat</div>
  <div id="messages"></div>
  <div id="typing"></div>
  <form id="message-form">
    <input type="text" id="message-input" placeholder="Type a message..." autocomplete="off">
    <button type="submit" id="message-submit">Send</button>
  </form>
</div>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
const BACKEND_URL = 'https://chat-1-zkny.onrender.com'; // Change to your backend URL
const socket = io(BACKEND_URL);

let username = prompt("Enter your username:") || "Anonymous";
let privateReceiver = null;
let onlineUsers = {};
let typingUsers = new Set();
let messageMap = new Map();
let windowFocused = true;

// Notification permission
if ("Notification" in window) Notification.requestPermission();

const usersListEl = document.getElementById("users-list");
const messagesEl = document.getElementById("messages");
const messageForm = document.getElementById("message-form");
const messageInput = document.getElementById("message-input");
const typingEl = document.getElementById("typing");
const chatStatus = document.getElementById("chat-status");

const colors = ['#FF4500','#FF8C00','#FFD700','#32CD32','#1E90FF','#8A2BE2','#FF69B4','#00CED1'];
function getColor(name){ let hash=0; for(let i=0;i<name.length;i++){ hash=name.charCodeAt(i)+((hash<<